<div class="chordGrid">
  <section class="chords" (cdkDropListDropped)="drop($event)" cdkDropList cdkDropListOrientation="mixed">
    @for (chord of chords; track trackById(chordIndex, chord); let chordIndex = $index) {
      <app-chord-card
        cdkDrag
        [visible]="chord.visible !== undefined ? chord.visible : true"
        [newChordUI]="false"
        [selectedMode]="selectedMode"
        [currentChordsLength]="chords.length"
        [chord]="chord"
        [chordPosition]="chordIndex"
        [isSelected]="chordIndex === chordSelected"
        (click)="selectChord(chordIndex)"
        (emitDeleteChord)="deleteChord(chordIndex)"
        (emitRemoveNote)="removeNote($event.notePosition, $event.chordPosition)"
      ></app-chord-card>
    }
    @if (selectedMode() === 'guesser' && chords.length <= maxChords) {
      <app-chord-card [newChordUI]="true" (emitNewChord)="addNewChord($event)"></app-chord-card>
    }
  </section>
</div>

<ng-container>
  @switch (selectedMode()) {
    @case ('handbook') {
      <ng-container *ngTemplateOutlet="handbookTemplate"></ng-container>
    }
    @case ('options') {
      <ng-container *ngTemplateOutlet="optionsTemplate"></ng-container>
    }
  }
</ng-container>

<ng-template #handbookTemplate>
  @if (handbookChords.length > 0 && chords.length > 0) {
    <span id="separation"></span>
  }
  @if (loading) {
    <mat-spinner id="spinner"></mat-spinner>
  } @else {
    <div class="handbookChordsGrid">
      <div class="handbookChords">
        @for (
          handbookChord of handbookChords;
          track trackById(handbookIndex, handbookChord);
          let handbookIndex = $index
        ) {
          <app-chord-card
            [@fadeAndSlide]="'in'"
            [newChordUI]="false"
            [selectedMode]="selectedMode"
            [currentChordsLength]="chords.length"
            [chord]="handbookChord"
            [chordPosition]="handbookIndex"
            [isSelected]="handbookIndex === handbookChordSelected"
            (click)="selecthandbookChord(handbookIndex)"
          ></app-chord-card>
        }
      </div>
    </div>
  }
</ng-template>
<ng-template #optionsTemplate>
  @if (alternativeChords.length > 0) {
    <span id="separation"></span>
  }
  @if (loading) {
    <mat-spinner id="spinner"></mat-spinner>
  } @else {
    <div class="alternativeChordsGrid">
      <div class="alternativeChords">
        @for (
          alternativeChord of alternativeChords;
          track trackById(alternativeChordIndex, alternativeChord);
          let alternativeChordIndex = $index
        ) {
          <app-chord-card
            [@fadeAndSlide]="'in'"
            [newChordUI]="false"
            [selectedMode]="selectedMode"
            [currentChordsLength]="chords.length"
            [chord]="alternativeChord"
            [chordPosition]="alternativeChordIndex"
            [isSelected]="alternativeChordIndex === alternativeChordSelected"
            (click)="selectAlternativeChord(alternativeChordIndex)"
          ></app-chord-card>
        }
      </div>
    </div>
  }
</ng-template>
